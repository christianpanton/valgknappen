<html>
  <head>
    <meta charset="UTF-8" />
    <script src="dk.api.stm.valg.UdskrivValgService.binding.min.js"></script>
    <link
      href="dk.api.stm.valg.UdskrivValgService.binding.min.css"
      rel="stylesheet"
    />
  </head>
  <body>
    <div class="regeringOverMidten">
      <div class="tick" data-value="" data-did-init="setupFlip">
        <div data-repeat="true" aria-hidden="true">
          <span data-view="flip"></span>
        </div>
      </div>

      <button id="valg"><span id="tekst">Valg!</span></button>
    </div>

    <script>
      var knap = document.getElementById("valg");
      var confetti = new JSConfetti();
      var dato = new Date();

      limited = false;

      function overSp√¶regr√¶nsen(v√¶rdi, fuzz) {
        var gr√¶nse = globalTick.value % Math.pow(10, v√¶rdi.toString().length);
        return v√¶rdi >= gr√¶nse - fuzz && v√¶rdi <= gr√¶nse + fuzz;
      }

      function valgtema() {
        if (overSp√¶regr√¶nsen(666, 1)) return ["üëø", "üòà", "ü§ò"];

        if (overSp√¶regr√¶nsen(420, 1))
          return ["üåø", "ü•¶", "üå≥", "üçÅ", "üçÉ", "üçÄ", "ü™¥", "üî•"];

        if (dato.getMonth() == 11)
          return ["üéÖ", "ü§∂", "üßë‚ÄçüéÑ", "‚ùÑÔ∏è", "‚òÉÔ∏è", "üéÅ", "üéÑ", "ü¶å"];

        if (dato.getMonth() == 1 && dato.getDay() == 14)
          return ["üíñ", "‚ù§Ô∏è", "ü•∞", "üòò", "üòç"];

        if (dato.getMonth() == 9 && dato.getDay() == 31)
          return ["üëª", "üéÉ", "ü¶á"];

        return ["üó≥Ô∏è", "üó≥Ô∏è", "üó≥Ô∏è", "ü¶†", "üò∑", "ü™ñ", "üá∫üá¶", "‚õΩ", "üôà", "üôâ", "üôä", "üåç", "üåä", "üî•"];
      }

      function setupFlip(tick) {
        globalTick = tick;
        fetch("/count")
          .then((r) => r.json())
          .then((j) => (tick.value = j["count"]));
      }

      function udskrivValget() {
        knap.classList.add("pressed");
        knap.removeEventListener("click", udskrivValget);

        if (!limited) {
          UdskrivValgServiceType_UdskrivValg();

          confetti.addConfetti({
            emojis: valgtema(),
          });

          setTimeout(function () {
            knap.classList.remove("pressed");
            knap.addEventListener("click", udskrivValget);
          }, 1500);
        }else{
          document.getElementById("tekst").style.fontSize = "50%";
          document.querySelector("#tekst").textContent = "Der kommer en rigtig god l√∏sning i morgen";
        }
      }

      knap.addEventListener("click", udskrivValget);
    </script>
  </body>
</html>
